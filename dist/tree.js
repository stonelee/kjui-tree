define("kjui/tree/1.1.0/tree",["$","kjui/grid/1.3.0/grid","arale/widget/1.0.3/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/widget/1.0.3/templatable","gallery/handlebars/1.0.0/handlebars","gallery/underscore/1.4.4/underscore","./row.tpl"],function(e,t,a){var i=e("$"),d=e("kjui/grid/1.3.0/grid"),s=e("gallery/handlebars/1.0.0/handlebars"),r=e("gallery/underscore/1.4.4/underscore"),n=e("./row.tpl"),c=d.extend({model:{paginate:!1,showRoot:!0,children:"children",multiSelect:!1,cascade:!1},setup:function(){this.$(".grid-view").addClass("grid-with-no-border"),c.superclass.setup.call(this)},_loadData:function(e){this.data=e,this._tree=this.$(".grid-view tbody"),this.model.showRoot?(this._createRow(["elbow-end-minus","folder"],e),this._loopRow(e,["elbow-empty"])):this._loopRow(e,[]),this._processData(),this.$(".grid-row").each(function(e,t){var a=i(t),d=a.data("data").icon;d&&a.find(".icon-tree-leaf,.icon-tree-folder").css("background",'url("'+d+'") no-repeat 0 0')}),this.model.multiSelect?(this.$(".icon-tree-leaf,.icon-tree-folder").before(i('<input type="checkbox" data-role="check">')),this.selected=[]):this.selected=null,this.trigger("loaded")},_loopRow:function(e,t){for(var a=this.model.children,i=e[a],d=0;i.length>d;d++){var s=i[d];0===s[a].length?d!=i.length-1?this._createRow(t.concat("elbow","leaf"),s):this._createRow(t.concat("elbow-end","leaf"),s):(d!=i.length-1?this._createRow(t.concat("elbow-minus","folder"),s):this._createRow(t.concat("elbow-end-minus","folder"),s),d!=i.length-1?this._loopRow(s,t.concat("elbow-line")):this._loopRow(s,t.concat("elbow-empty")))}},_createRow:function(e,t){var a=[];this.model.fields&&(a=i.map(this.model.fields,function(e){if(e.name){var a=t[e.name];a=r.escape(a),i.isFunction(e.render)&&(a=e.render(a));var d=r.clone(e);return d.value=a,d}}));var d=t[this.model.children],c=s.compile(n)({id:t.id,icons:e,name:t.name,expanded:0!==d.length?!0:!1,leaf:0===d.length?!0:!1,grids:a}),l=i(c);l.data("data",t),this._tree.append(l)},_processData:function(){var e=this,t=this.model.children;this.$(".grid-row").each(function(a,d){var s=i(d),r=s.data("data")[t];i.each(r,function(t,a){var i=e.$(".grid-row[data-id="+a.id+"]");i.data("parent",s),i.data("siblings",e._getSiblings(a.id,r))});var n=[];e._getChildren(s.data("data"),n),s.data("children",n)}),this.$(".grid-row").each(function(a,d){var s=i(d);s.data("parent")||s.data("siblings",e._getSiblings(s.data("data").id,e.data[t]))})},_getChildren:function(e,t){var a=this,d=this.model.children;i.each(e[d],function(e,i){var s=a.$(".grid-row[data-id="+i.id+"]");t.push(s),i[d].length>0&&a._getChildren(i,t)})},_getSiblings:function(e,t){var a=this,d=[];return i.each(t,function(t,i){i.id!==e&&d.push(a.$(".grid-row[data-id="+i.id+"]"))}),d},events:{"click [class$=-minus],[class$=-plus]":"_toggle","dblclick  [data-role=expander] [data-role=text]":"_toggle","click .grid-row":"_click","click [data-role=check]":"_check"},_toggle:function(e){var t=i(e.target),a=t.parents("tr");"expanded"==a.attr("data-status")?this.shrink(a):this.expand(a)},expand:function(e){this._show(e),this._changeIcon(e,"plus","minus"),e.attr("data-status","expanded")},shrink:function(e){this._hide(e),this._changeIcon(e,"minus","plus"),e.removeAttr("data-status")},_changeIcon:function(e,t,a){var i=e.find("[class$=-"+t+"]"),d=i.attr("class");d=d.replace(t,a),i.attr("class",d)},_show:function(e){var t=this;i.each(e.data("data")[this.model.children],function(e,a){var i=t.$(".grid-row[data-id="+a.id+"]");i.show(),"expanded"==i.attr("data-status")&&t._show(i)})},_hide:function(e){var t=this;i.each(e.data("data")[this.model.children],function(e,a){var i=t.$(".grid-row[data-id="+a.id+"]");i.hide(),"expander"==i.attr("data-role")&&"expanded"==i.attr("data-status")&&t._hide(i)})},_click:function(e){var t=i(e.target),a=t.parents("tr"),d=a.data("data");/minus|plus/.test(t.attr("class"))||(this.model.multiSelect||(this.selected&&this.selected.data("data").id===d.id?(this.selected=null,a.removeClass("grid-row-is-selected")):(this.selected=a,a.addClass("grid-row-is-selected").siblings().removeClass("grid-row-is-selected"))),"check"!=t.attr("data-role")&&this.trigger("click",t,d))},_check:function(e){var t=this,a=i(e.target),d=a.parents("tr");a.prop("checked")?(this._checkRow(d),this.model.cascade&&i.each(d.data("children"),function(e,a){t.check(a)})):(this._unCheckRow(d),this.model.cascade&&i.each(d.data("children"),function(e,a){t.unCheck(a)}))},_checkRow:function(e){this.selected.push(e),e.addClass("grid-row-is-selected")},_unCheckRow:function(e){for(var t=e.data("data").id,a=this.selected.length-1;a>=0;a--)this.selected[a].data("data").id===t&&this.selected.splice(a,1);e.removeClass("grid-row-is-selected")},check:function(e){var t=e.find("[data-role=check]");t&&(t.prop("checked")||(this._checkRow(e),t.prop("checked",!0)))},unCheck:function(e){var t=e.find("[data-role=check]");t&&t.prop("checked")&&(this._unCheckRow(e),t.prop("checked",!1))},select:function(e){if(!this.model.multiSelect){for(var t=e.data("parent");t;)"expanded"!=t.attr("data-status")&&this.expand(t),t=t.data("parent");this.selected=e,e.addClass("grid-row-is-selected").siblings().removeClass("grid-row-is-selected");var a=e.parent().children(":visible").index(e);this.$(".grid-view").scrollTop(e.height()*a);var i=e.data("data");this.trigger("click",e,i)}},refresh:function(){var e=this.get("url");this._onRenderUrl(e)}});a.exports=c}),define("kjui/tree/1.1.0/row.tpl",[],'<tr class="grid-row" data-id="{{id}}" {{#if expanded}}data-status="expanded"{{/if}} {{#if leaf}}data-role="leaf"{{else}}data-role="expander"{{/if}}>\n  <td class="grid-cell">\n    {{#each icons}}<i class="icon-tree-{{this}}"></i>{{/each}}<span data-role="text" class="tree-item">{{name}}</span>\n  </td>\n  {{#each grids}}\n    <td class="grid-cell"{{#if align}} style="text-align:{{align}};"{{/if}}>\n      {{{value}}}\n    </td>\n  {{/each}}\n</tr>\n');
